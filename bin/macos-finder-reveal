#!/usr/bin/env bash

usage() {
  cat <<EOF
Usage: $(basename "$0") FILE...

Reveal files and directories in Finder (macOS).

Arguments:
  FILE        One or more files or directories to reveal in Finder

Options:
  --help      Display this help message and exit

Examples:
  $(basename "$0") *.jpg
  $(basename "$0") /path/to/file.txt
  $(basename "$0") document.pdf image.png

Similar to the 'open' command, but selects (reveals) files in Finder instead of
opening them. The script activates Finder and highlights the specified files.
EOF
  exit 0
}

if [[ "$1" == "--help" ]]; then
  usage
fi

if [ $# -eq 0 ]; then
  usage
fi

# NOTE: Remove redirect when debugging! http://stackoverflow.com/q/11902524/11543
/usr/bin/osascript - "$@" <<END 2>&1 | grep -v CFURLGetFSRef

on run argv

  set errorString to ""
  set fileList to {}

  repeat with s in argv
    try
      set end of fileList to (alias (POSIX file s))
    on error
      # Patterned after the "open" error message
      set errorString to errorString & "The file " & s & " does not exist."
    end try
  end repeat

  if not fileList = {}
    tell application "Finder"
      reveal fileList
      activate
    end tell
  end if

  if not errorString = ""
    return errorString
  end if

  tell application "System Events" to set frontmost of process "Finder" to true

end run

END

exit 0
