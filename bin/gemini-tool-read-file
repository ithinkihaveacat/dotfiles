#!/usr/bin/env bash

set -eo pipefail

usage() {
  cat <<EOF
Usage: $(basename "$0") FILE

Generates [tool_code] for read_file() with the specified file and copies it
to the clipboard.

Arguments:
  FILE        The path to the file to read.

Options:
  --help      Display this help message and exit

Examples:
  $(basename "$0") AGENTS.md
EOF
  exit 0
}

if [[ "$1" == "--help" ]]; then
  usage
fi

if [ $# -eq 0 ]; then
  usage 1 >&2
fi

require() {
  command -v "$1" >/dev/null 2>&1 || {
    echo >&2 "$(basename "$0"): $1 not found"
    exit 127
  }
}

require realpath

FILENAME="$1"
ABSOLUTE_PATH=$(realpath "$FILENAME")

TOOL_CODE="[tool_code]
read_file(absolute_path='$ABSOLUTE_PATH', limit=50000)
[/tool_code]"

if command -v pbcopy >/dev/null 2>&1; then
  echo "$TOOL_CODE" | pbcopy
  echo "[tool_code]read_file(...)[/tool_code] copied to clipboard"
else
  echo "$TOOL_CODE"
fi
