#!/bin/bash

set -e

for cmd in realpath; do
  if ! hash "$cmd" 2>/dev/null; then
    echo "error: required command '$cmd' not found in PATH." >&2
    exit 1
  fi
done

# Check for filename argument
if [ $# -eq 0 ]; then
  echo "usage: $(basename "$0") <filename>" >&2
  exit 1
fi

FILENAME="$1"
ABSOLUTE_PATH=$(realpath "$FILENAME")

TOOL_CODE="[tool_code]
read_file(absolute_path='$ABSOLUTE_PATH', limit=50000)
[/tool_code]"

if hash "pbcopy" 2>/dev/null; then
  echo "$TOOL_CODE" | pbcopy
  echo "\[tool_code]read_file(...)[/tool_code] copied to clipboard"
else
  echo "$TOOL_CODE"
fi