#!/usr/bin/env bash

require() { hash "$@" || exit 127; }

require scrcpy

filename="$1"

if [ -z "$filename" ]; then
  filename=$(date -u +'adb-screenrecord-%Y%m%d%H%M%S.mp4')
fi

adb shell log -t scrcpy "screen recording to $1"

SHOW_TOUCHES="adb shell -n settings get system show_touches"
trap "$(printf 'adb shell -n settings put system show_touches %s' "$($SHOW_TOUCHES)")" EXIT

adb shell -n settings put system show_touches 1
scrcpy -N -t -w -r "$filename"
