#!/usr/bin/env bash

usage() {
  cat <<EOF
Usage: $(basename "$0") PACKAGE [OPTIONS]

Stream logcat output for a specific package name.

Arguments:
  PACKAGE     The package name to filter logs for (e.g., com.example.app)

Options:
  -h, --help  Display this help message and exit

Examples:
  $(basename "$0") com.android.chrome
  $(basename "$0") com.example.myapp

Note: The package must be running on the device to determine its PID.
EOF
  exit 0
}

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  usage
fi

if [[ -z "$1" ]]; then
  usage
fi

require() { hash "$@" || exit 127; }

require adb

# Check device availability
if ! adb get-state >/dev/null 2>&1; then
  if [[ -n "$ANDROID_SERIAL" ]]; then
    echo "$(basename "$0"): device '$ANDROID_SERIAL' not available" >&2
  else
    echo "$(basename "$0"): no device connected" >&2
  fi
  exit 1
fi

if ! PID=$(adb exec-out pidof "$1"); then
  echo "$(basename "$0"): package [$1] not running" >&2
  exit 1
fi

# -d to disable blocking
adb logcat -v time --pid="${PID[0]}"