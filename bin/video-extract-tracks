#!/usr/bin/env bash

usage() {
  cat <<EOF
Usage: $(basename "$0") FILE

Extracts audio and video tracks from a video file into separate files.

Arguments:
  FILE        The input video file.

Options:
  --help      Display this help message and exit

Examples:
  $(basename "$0") movie.mp4
EOF
  exit 0
}

if [[ "$1" == "--help" ]]; then
  usage
fi

if [[ $# -ne 1 ]]; then
  usage 1 >&2
fi

if [[ ! -f "$1" ]]; then
  echo "$(basename "$0"): $1: No such file" >&2
  exit 1
fi

require() {
  command -v "$1" >/dev/null 2>&1 || {
    echo >&2 "$(basename "$0"): $1 not found"
    exit 127
  }
}

require ffmpeg

basename=$(basename -- "$1")
dirname=$(dirname -- "$1")
extension="${basename##*.}"
filename="${basename%.*}"

audiofile="${dirname}/${filename}-audio.mp3"
videofile="${dirname}/${filename}-video.${extension}"

# Extract audio - using MP3 for common compatibility
ffmpeg -i "$1" -vn -ab 192k -ar 44100 -f mp3 "$audiofile"
echo "Audio extracted to $audiofile"

# Extract video - using H.264 (mp4) for broad compatibility
ffmpeg -i "$1" -an -c:v copy "$videofile"
echo "Video extracted to $videofile"
