#!/usr/bin/env bash

set -e

BUILD_DIR=$(mktemp -d)
trap 'rm -rf "$BUILD_DIR"' EXIT

require() {
    hash "$@" || { echo "Error: Command '$1' not found." >&2; exit 127; }
}

require curl
require unzip
require repomix

URL="https://github.com/modelcontextprotocol/modelcontextprotocol/archive/refs/heads/main.zip"
ZIP_FILE="$BUILD_DIR/main.zip"
EXTRACT_DIR="$BUILD_DIR"
DOCS_DIR="$EXTRACT_DIR/modelcontextprotocol-main"

curl -sSL -o "$ZIP_FILE" "$URL"
unzip -o -q "$ZIP_FILE" \
    "modelcontextprotocol-main/docs/docs/learn/server-concepts.mdx" \
    "modelcontextprotocol-main/docs/docs/learn/architecture.mdx" \
    "modelcontextprotocol-main/docs/specification/2025-06-18/*" \
    -d "$EXTRACT_DIR"
repomix "$DOCS_DIR" \
    --include="docs/docs/learn/server-concepts.mdx,docs/docs/learn/architecture.mdx,docs/specification/2025-06-18/*" \
    --no-security-check --quiet -o -