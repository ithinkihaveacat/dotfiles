#!/usr/bin/env bash

usage() {
  cat <<EOF
Usage: $(basename "$0")

Dumps the state of the RpcTracker from the Wearable Service.

This script extracts the section of the 'dumpsys wearableservice' output
that tracks remote procedure calls (RPCs) made using the MessageClient.
It shows which paths are being called and how often.

Options:
  -h, --help  Display this help message and exit

Examples:
  # Show all RPC tracker information
  $(basename "$0")

  # Find information about a specific RPC path
  $(basename "$0") | grep "/my_app/rpc_path"
EOF
  exit 0
}

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  usage
fi

require() { hash "$@" || exit 127; }

require adb

adb exec-out dumpsys activity service WearableService | sed -n '/RpcTracker/,/######/p'
