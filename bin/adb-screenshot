#!/usr/bin/env bash

require() { hash "$@" || exit 127; }

require adb
require exiftool

filename="$1"

if [ -z "$filename" ]; then
  filename=$(date -u +'adb-screenshot-%Y%m%d%H%M%S.png')
fi

DPI=$(adb shell wm density | awk '{ print $NF }')

adb shell log -t screencap "screenshot to $filename"
adb shell -n screencap -p > "$filename"
exiftool -overwrite_original_in_place -XResolution="$DPI" -YResolution="$DPI" "$filename"

echo "Saved to $filename"
